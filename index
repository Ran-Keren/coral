<!doctype html>
<html lang="he" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>××•×¦×¨×™ ×—×œ×‘ ××: ×¡×‘×•×Ÿ ×˜×‘×¢×™ + ×ª×¤×¨×™×˜</title>
    <style>
        :root{
            --gap:18px;
            --accent:#00695C; /* Dark Teal - A calm, natural color */
            --bg:#e0f7fa; /* Light Cyan */
            --text:#222;
            --success: #28a745;
            --error: #dc3545;
            --sidebar-width: 250px;
            --soft-white: #fefefe; /* A slightly warmer white */
        }
        html,body{
            height:100%;
            margin:0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans Hebrew', sans-serif;
            background: var(--bg);
            color:var(--text);
            overflow-x: hidden;
        }
        .app{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;box-sizing:border-box; flex-direction: column;}
        .logo-container {
            margin-bottom: 24px;
            text-align: center;
        }
        .logo {
            max-width: 200px;
            height: auto;
        }
        .card{width:100%;max-width:1100px;background:linear-gradient(180deg,var(--soft-white),#fbfbfb);border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,0.15);overflow:hidden;display:flex;gap:var(--gap);flex-direction:row-reverse; position: relative;}
        .content{flex:1;min-width:260px;padding:28px;display:flex;flex-direction:column;gap:14px}
        h1{margin:0;font-size:26px; color: var(--accent); text-align: right;}
        h2{font-size: 22px; color: var(--accent); border-bottom: 2px solid #eee; padding-bottom: 8px; margin-top: 25px; font-weight: 700;}
        p{margin:0;line-height:1.7}
        .lead{font-weight:600}
        
        /* CTA & Coupon Styles */
        .cta{margin-top:auto;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
        .btn{background:var(--accent);color:#fff;border:none;padding:12px 18px;border-radius:10px;font-weight:700;cursor:pointer;transition:all 0.3s; text-align: center; box-shadow: 0 4px 10px rgba(0,105,92,0.2);}
        .btn:hover{background:#004d40;transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,105,92,0.4)}
        .price{font-size:22px;font-weight:800;color:var(--accent)}
        .natural-text { color: var(--accent); font-weight: 600; padding: 10px 0; border-right: 3px solid var(--accent); padding-right: 10px; }
        
        /* Coupon Styles */
        .coupon-section {
            display: flex;
            gap: 10px;
            align-items: flex-start; 
            margin-top: 15px;
            flex-direction: column; 
            align-items: center; 
        }
        .coupon-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .coupon-section input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 140px;
            font-size: 15px;
            text-align: center;
            direction: ltr; 
        }
        .btn-apply {
            background: var(--accent);
            border: 1px solid var(--accent);
            color: #fff;
            padding: 10px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 15px;
            transition: all 0.2s;
            box-shadow: none;
        }
        .btn-apply:hover {
            background: #004d40;
            color: #fff;
        }
        .coupon-msg {
            font-size: 14px;
            font-weight: 700;
            min-height: 20px;
            text-align: center;
            margin-top: 5px;
        }
        .coupon-msg.success { color: var(--success); }
        .coupon-msg.error { color: var(--error); }


        .carousel-wrap{width:520px;max-width:48%;min-width:300px;background: #f5f5f5;border-radius:12px;overflow:hidden;position:relative;display:flex;align-items:center;justify-content:center}
        .slide img{width:100%;height:100%;object-fit:cover;display:block}

        /* Modal Styles - Enhanced for professionalism */
        .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;overflow-y: auto; padding: 20px 0;}
        .modal.show{display:flex}
        .modal-content{
            background:var(--soft-white);
            padding:35px;
            border-radius:18px;
            max-width:450px;
            width:90%;
            text-align:right;
            box-shadow:0 30px 80px rgba(0,0,0,0.4); 
            margin: auto; /* Center vertically when content is small */
            border-top: 5px solid var(--accent); /* Accent border */
        }
        .modal h2{margin:0 0 20px;color:var(--accent); text-align: center; font-size: 26px; border-bottom: none; padding-bottom: 0;}
        .modal p{margin:10px 0;line-height:1.6}
        .modal-buttons{display:flex;gap:15px;margin-top:25px;justify-content:center; flex-wrap: wrap;}
        select{width:100px;padding:8px;border-radius:8px;border:1px solid #ccc;font-size:15px;text-align:center;cursor:pointer; background-color: #f9f9f9;}
        .form-group{margin-bottom: 20px; text-align: right;}
        .form-group label{display: block; margin-bottom: 5px; font-weight: 600; color: #333;}
        .form-group input{width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; background-color: #f9f9f9;}
        .price-container {
            text-align: center;
            padding: 15px;
            border: 1px dashed #ccc;
            border-radius: 10px;
            background-color: #f5f5f5;
        }
        .old-price {
            text-decoration: line-through;
            color: #999;
            font-size: 16px;
            margin-left: 10px;
            display: none;
        }
        .old-price.show { display: inline-block; }

        /* Payment Modal Specific Styling */
        #paymentModalTitle {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 10px;
        }
        #paymentModal .modal-content {
            background: linear-gradient(135deg, var(--soft-white), #f0fff0); /* Lighter, calming gradient */
            max-width: 400px;
            padding: 30px;
        }
        #paymentModal p {
            text-align: center;
            font-size: 16px;
            color: #555;
            margin: 15px 0;
        }
        #paymentModal p strong {
            display: block;
            font-size: 20px;
            color: var(--accent);
            margin-top: 10px;
        }
        #paymentTotalAmount {
            font-size: 32px !important;
            font-weight: 800;
            color: #E91E63; /* Eye-catching color for the final price */
            display: inline;
            direction: ltr;
        }
        #openBitApp {
            background-color: #4CAF50; /* Green for payment button */
            transition: all 0.3s;
            padding: 14px 25px;
            font-size: 18px;
        }
        #openBitApp:hover {
            background-color: #388E3C;
        }


        /* --- Sidebar Styles --- */
        #sidebar-toggle {
            /* Position changed to top-right (left: 20px -> right: 20px) */
            position: fixed; /* Fixed position so it stays visible when scrolling */
            top: 20px;
            right: 20px; 
            left: auto; /* Resetting left */
            background: var(--accent);
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            z-index: 100; /* High z-index to be on top of everything */
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .sidebar {
            position: fixed;
            top: 0;
            right: -250px; /* Hidden off-screen */
            width: var(--sidebar-width);
            height: 100%;
            background: var(--soft-white);
            box-shadow: -4px 0 15px rgba(0,0,0,0.15);
            transition: right 0.3s ease-in-out;
            z-index: 150; /* Higher Z-index than toggle/overlay */
            padding: 25px 20px;
            box-sizing: border-box;
            overflow-y: auto;
            text-align: right;
        }
        .sidebar.open {
            right: 0; 
        }
        .close-sidebar {
            background: none;
            border: none;
            font-size: 35px;
            position: absolute;
            left: 10px;
            top: 5px;
            cursor: pointer;
            color: var(--accent);
            line-height: 1;
            font-weight: 300;
        }
        .sidebar h3 {
            color: var(--accent);
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .sidebar ul {
            list-style: none;
            padding: 0;
        }
        .sidebar li {
            margin-bottom: 10px;
        }
        .sidebar a {
            color: var(--text);
            text-decoration: none;
            display: block;
            padding: 8px 0;
            transition: color 0.2s;
            font-weight: 500;
        }
        .sidebar a:hover {
            color: #00897B; /* Slightly lighter accent */
            padding-right: 5px;
        }
        
        /* Overlay for Sidebar */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 120; /* Between toggle and sidebar */
            cursor: pointer;
        }
        .overlay.show {
            display: block;
        }

        /* Responsive */
        @media (max-width:900px){
            .card{flex-direction:column-reverse}
            .carousel-wrap{width:100%;max-width:none;min-width:0;height:320px}
            .content{padding:18px}
        }
        
        /* Mobile Specific: Hide Sidebar Toggle button on very small screens (if desired) */
        @media (max-width: 550px) {
            #sidebar-toggle {
                right: 15px;
                top: 15px;
                padding: 8px 12px;
                font-size: 14px;
            }
            .sidebar {
                width: 80%; /* Adjusted for better phone view */
            }
            .modal-content {
                padding: 25px;
            }
        }

    </style>
</head>
<body>
    <div class="overlay" id="sidebar-overlay"></div>
    <div class="sidebar" id="sidebar">
        <button class="close-sidebar" id="close-sidebar-btn">Ã—</button> 
        <h3>×ª×•×›×Ÿ ×¢× ×™×™× ×™× âœ¨</h3>
        <ul>
            <li><a href="#product-description">××•×“×•×ª ×”××•×¦×¨</a></li>
            <li><a href="#benefits">×™×ª×¨×•× ×•×ª ×”×¡×‘×•×Ÿ</a></li>
            <li><a href="#ingredients">×¨×›×™×‘×™× ×˜×‘×¢×™×™×</a></li>
            <li><a href="#order-form">×”×–×× ×” ×•×ª×©×œ×•×</a></li>
        </ul>
        <p style="margin-top: 30px; font-size: 14px; color: #666;">
            ×œ×›×œ ×©××œ×” × ×•×¡×¤×ª, × ×™×ª×Ÿ ×œ×™×¦×•×¨ ×§×©×¨.
        </p>
    </div>

    <div class="app">
        <button id="sidebar-toggle">×ª×¤×¨×™×˜ â˜°</button>
        <div class="logo-container">
            <img src="https://i.imgur.com/sLoJrqk.png" alt="×œ×•×’×• ×˜×‘×¢×™" class="logo">
        </div>
        <div class="card" role="application">
            <div class="content">

                <h1>ğŸ§¼ ×¡×‘×•×Ÿ ×˜×‘×¢×™ ××—×œ×‘ ××: ××ª× ×ª ×”×˜×‘×¢ ×œ×¢×•×¨ ×”×¨×š</h1>

                <p class="lead" id="product-description">
                    ×”×›×™×¨×• ××ª ×”×¡×‘×•×Ÿ ×”×˜×‘×¢×™ ×”××™×•×—×“ ×©×œ× ×•, ×”××©×œ×‘ ××ª ×›×œ ×”×˜×•×‘ ×©×‘×—×œ×‘ ×× ×¢× ×©×× ×™× ×•×¨×›×™×‘×™× ×‘×•×˜× ×™×™× ××•×¨×’× ×™×™×. ×¤×ª×¨×•×Ÿ ××•×©×œ× ×œ×¢×•×¨ ×¨×’×™×©, ×™×‘×© ××• ××’×•×¨×”.
                </p>

                <p class="natural-text">
                    **××™×•×¦×¨ ×‘××”×‘×” ×•×‘×©×™×˜×” ××¡×•×¨×ª×™×ª ×§×¨×”** â€“ ×œ×©××™×¨×” ××§×¡×™××œ×™×ª ×¢×œ ×”×¨×›×™×‘×™× ×”×¤×¢×™×œ×™× ×•×”××™× ×¨×œ×™× ×‘×—×œ×‘ ×”××.
                </p>

                <hr>

                <h2 id="benefits">ğŸŒ¿ ×™×ª×¨×•× ×•×ª ×”×¡×‘×•×Ÿ ×”×˜×‘×¢×™</h2>
                <ul>
                    <li>**×”×–× ×” ×•×¨×›×•×ª:** ×—×œ×‘ ×× ×¢×©×™×¨ ×‘× ×•×’×“× ×™×, ×•×™×˜××™× ×™× ×•×©×•×× ×™× ×—×™×•× ×™×™× ×”××–×™× ×™× ××ª ×¢×•×¨ ×”×ª×™× ×•×§ ×•×”××.</li>
                    <li>**×”×§×œ×” ×•×”×¨×’×¢×ª ×¢×•×¨:** ××•××œ×¥ ×‘××™×•×—×“ ×œ×¢×•×¨ ×”×¡×•×‘×œ ×××§×–××”, ×¤×¨×™×—×” ××• ×’×™×¨×•×™×™× (×›×•×œ×œ "×›×•×‘×¢" ×‘×¨××© ×”×ª×™× ×•×§).</li>
                    <li>**100% ×˜×‘×¢×™:** ×œ×œ× SLS, ×¤×¨××‘× ×™×, ×—×•××¨×™ ×¨×™×— ×¡×™× ×˜×˜×™×™× ××• ×›×™××™×§×œ×™× ×§×©×™×.</li>
                </ul>

                <h2 id="ingredients">ğŸŒ± ×¨×›×™×‘×™× ×•×™×™×¦×•×¨</h2>
                <p>
                    ×”×¡×‘×•×Ÿ ×©×œ× ×• ××›×™×œ ×ª×¢×¨×•×‘×ª ×× ×¦×—×ª ×©×œ ×—×œ×‘ ××, **×©××Ÿ ×–×™×ª ×›×ª×™×ª ××¢×•×œ×”**, **×—×××ª ×©×™××”** ×•×©×× ×™× ××ª×¨×™×™× ×¢×“×™× ×™×. ×›×œ ×¡×‘×•×Ÿ ××™×•×¦×¨ ×‘×ª×”×œ×™×š ×™×™×¦×•×¨ ×§×¤×“× ×™ (Cold Process) ×”×©×•××¨ ×¢×œ ×ª×›×•× ×•×ª ×”×¨×™×›×•×š ×•×”×œ×—×•×ª ×©×œ ×”×¨×›×™×‘×™×.
                </p>

                <h2 id="order-form">ğŸ ×”×–×× ×” ×•×ª×©×œ×•×</h2>
                
                <div class="cta" style="margin-top: 30px;">
                    <button class="btn" id="openOrderModalBtn" style="width: 100%;">×œ×”×–×× ×” ×•×œ××¢×‘×¨ ×œ×ª×©×œ×•× ğŸ›’</button>
                </div>
                
            </div>

            <div class="carousel-wrap" aria-roledescription="carousel">
                <div class="slides-container">
                    <div class="slides" id="slides">
                        <div class="slide"><img alt="×¡×‘×•×Ÿ ××—×œ×‘ ×× ×˜×‘×¢×™" src="https://i.imgur.com/CQZCkT5.jpeg"/></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="shippingModal">
        <div class="modal-content">
            <h2>×”×–×× ×” ×•×¤×¨×˜×™ ××©×œ×•×— ğŸ“¦</h2>
            <p style="text-align: center; font-weight: 500;">×× × ×‘×—×¨×• ×›××•×ª ×•××œ××• ×¤×¨×˜×™×:</p>
            
            <div class="form-group" style="text-align: center;">
                <label for="copies" style="font-size: 16px; margin-bottom: 8px;">×›××•×ª ×¡×‘×•× ×™× (×™×—×™×“×•×ª):</label>
                <select id="copies">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
                <div class="price-container" style="margin-top: 15px;">
                    <span class="old-price" id="oldPrice"></span>
                    <div class="price" id="totalPrice">â‚ª45</div>
                </div>
            </div>

            <div class="coupon-section">
                <div class="coupon-input-group">
                    <input type="text" id="couponCode" placeholder="×§×•×“ ×§×•×¤×•×Ÿ">
                    <button type="button" class="btn-apply" id="applyCouponBtn">×”×—×œ</button>
                </div>
                <div class="coupon-msg" id="couponMsg"></div>
            </div>
            <hr style="border: 0; border-top: 1px dashed #eee; margin: 20px 0;">

            <div class="form-group"><label for="shippingName">×©× ××œ×</label><input type="text" id="shippingName" required placeholder="×©× ×•×©× ××©×¤×—×”"></div>
            <div class="form-group"><label for="shippingPhone">×˜×œ×¤×•×Ÿ</label><input type="tel" id="shippingPhone" required placeholder="05X-XXXXXXX"></div>
            <div class="form-group"><label for="shippingEmail">×“×•×"×œ</label><input type="email" id="shippingEmail" required placeholder="example@mail.com"></div>
            <div class="form-group"><label for="shippingCity">×¢×™×¨</label><input type="text" id="shippingCity" required placeholder="×œ×“×•×’××”: ×ª×œ ××‘×™×‘"></div>
            <div class="form-group"><label for="shippingAddress">×›×ª×•×‘×ª ××œ××”</label><input type="text" id="shippingAddress" required placeholder="×¨×—×•×‘, ××¡×¤×¨ ×‘×™×ª, ×“×™×¨×”"></div>
            <div class="modal-buttons">
                <button class="btn" id="continueToPaymentBtn" style="flex-grow: 1;">×”××©×š ×œ×ª×©×œ×•× (Bit / ×›×¨×˜×™×¡)</button>
                <button class="btn close-modal" data-modal="shippingModal" style="background: #999; flex-grow: 1;">×‘×™×˜×•×œ</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <h2 id="paymentModalTitle">×©×œ×‘ ×”×ª×©×œ×•× ×”×¡×•×¤×™ âœ…</h2>
            <p>
                <strong>×¡×›×•× ×œ×ª×©×œ×•× ×¡×•×¤×™: </strong><br>
                <span id="paymentTotalAmount">â‚ª45</span>
            </p>
            <hr style="border: 0; border-top: 1px solid #ddd; margin: 20px 0;">
            <p>
                ×œ××—×¨ ×œ×—×™×¦×” ×¢×œ "××¢×‘×¨ ×œ×ª×©×œ×•× ×××•×‘×˜×—" (××¤×©×¨×•×™×•×ª Bit / ×›×¨×˜×™×¡) ×ª×™×©×œ×— ××œ×™×›× **×”×–×× ×ª ×ª×©×œ×•×** (×œ×™× ×§) ×‘××™×™×œ ××• SMS, ×•×¤×¨×˜×™ ×”×”×–×× ×” ×©×œ×›× ×™×•×¢×‘×¨×• ×œ×˜×™×¤×•×œ.
            </p>
            <div class="modal-buttons">
                <button class="btn" id="openBitApp" style="width: 100%;">××¢×‘×¨ ×œ×ª×©×œ×•× ×××•×‘×˜×—</button>
                <button class="btn close-modal" data-modal="paymentModal" style="background: #999; width: 100%; margin-top: 5px;">×—×–×¨×” ×œ×¤×¨×˜×™ ××©×œ×•×—</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    
    <script>
        // ğŸ›‘ STEP 1: Replace 'YOUR_USER_ID' with your actual EmailJS User ID
        emailjs.init('ecHybfD_vT68aQGnO'); 

        const PRICE_PER_BOOK = 45; 
        
        // --- Coupon Logic Variables ---
        const COUPONS = {
            'TALYA20': 0.20, 
            'TALYA10': 0.10  
        };
        let isDiscountApplied = false;
        let discountRate = 0; 

        // Elements
        const copiesInput = document.getElementById('copies');
        const totalPriceEl = document.getElementById('totalPrice');
        const oldPriceEl = document.getElementById('oldPrice'); 
        
        // NEW: Button to open the order modal
        const openOrderModalBtn = document.getElementById('openOrderModalBtn'); 

        const shippingModal = document.getElementById('shippingModal');
        const continueToPaymentBtn = document.getElementById('continueToPaymentBtn');
        const paymentModal = document.getElementById('paymentModal');
        const paymentTotalAmount = document.getElementById('paymentTotalAmount');
        const openBitApp = document.getElementById('openBitApp'); 

        // Coupon Elements
        const couponInput = document.getElementById('couponCode');
        const applyCouponBtn = document.getElementById('applyCouponBtn');
        const couponMsg = document.getElementById('couponMsg');

        // Sidebar Elements
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const closeSidebarBtn = document.getElementById('close-sidebar-btn');
        const sidebarOverlay = document.getElementById('sidebar-overlay');


        let currentOrderData = {};

        function updateTotal() {
            const quantity = parseInt(copiesInput.value) || 1;
            let total = PRICE_PER_BOOK * quantity;
            
            if (isDiscountApplied) {
                const originalTotal = total;
                total = total * (1 - discountRate);
                total = Math.round(total); 
                
                oldPriceEl.textContent = `â‚ª${originalTotal}`;
                oldPriceEl.classList.add('show');
            } else {
                oldPriceEl.classList.remove('show');
            }

            totalPriceEl.textContent = `â‚ª${total}`;
            paymentTotalAmount.textContent = `â‚ª${total}`; 
        }

        function applyCoupon() {
            const inputCode = couponInput.value.trim().toUpperCase();
            
            if (COUPONS.hasOwnProperty(inputCode)) {
                if (!isDiscountApplied) {
                    isDiscountApplied = true;
                    discountRate = COUPONS[inputCode]; 
                    const discountPercent = discountRate * 100;

                    couponMsg.textContent = `×”×§×•×¤×•×Ÿ ×”×•×¤×¢×œ ×‘×”×¦×œ×—×”! (${discountPercent}% ×”× ×—×”)`;
                    couponMsg.className = "coupon-msg success";
                    
                    couponInput.disabled = true; 
                    applyCouponBtn.disabled = true;
                    applyCouponBtn.textContent = "V";
                    updateTotal();
                }
            } else if (inputCode === "") {
                couponMsg.textContent = "×× × ×”×–×Ÿ ×§×•×“ ×§×•×¤×•×Ÿ";
                couponMsg.className = "coupon-msg error";
            } else {
                couponMsg.textContent = "×§×•×“ ×§×•×¤×•×Ÿ ×©×’×•×™";
                couponMsg.className = "coupon-msg error";
            }
        }


        function closeModal(modalElement) {
            modalElement.classList.remove('show');
        }

        // --- Sidebar Logic ---
        function toggleSidebar() {
            sidebar.classList.toggle('open');
            sidebarOverlay.classList.toggle('show');
        }

        sidebarToggle.addEventListener('click', toggleSidebar);
        closeSidebarBtn.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);
        
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                    toggleSidebar();
                }
            });
        });

        // --- Email Sending Function ---
        function sendOrderEmail() {
            if (Object.keys(currentOrderData).length === 0) {
                console.error('Error: No order data available for email sending.');
                return;
            }

            emailjs.send('service_cprtttd', 'template_m39ushb', {
                to_email: 'c203240130@gmail.com', 
                name: currentOrderData.name,
                phone: currentOrderData.phone,
                email: currentOrderData.email,
                city: currentOrderData.city,
                address: currentOrderData.address,
                copies: currentOrderData.copies,
                total: currentOrderData.totalPrice,
                product_name: "×¡×‘×•×Ÿ ×˜×‘×¢×™ ××—×œ×‘ ××" 
            })
            .then(function(response) {
                console.log('SUCCESS! Order details sent to seller.', response.status, response.text);
            }, function(error) {
                console.log('FAILED to send order details.', error);
            });
        }


        // --- Event Listeners and Logic ---
        
        // NEW: Open Shipping Modal
        openOrderModalBtn.addEventListener('click', ()=>{ 
            updateTotal();
            shippingModal.classList.add('show'); 
        });

        // Price and Coupon Logic moved to be active inside the modal
        copiesInput.addEventListener('change', updateTotal);
        applyCouponBtn.addEventListener('click', applyCoupon);
        couponInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                applyCoupon();
            }
        });
        
        updateTotal(); 


        // Carousel Logic (kept for basic image display)
        (function(){
            const slidesEl = document.getElementById('slides');
            const slides = Array.from(slidesEl.children);
            if (slides.length <= 1) return; // Disable carousel if only one slide
            // const dotsEl = document.getElementById('dots'); // ×œ× ×§×™×™× ×‘-HTML
            // const prev = document.getElementById('prev'); // ×œ× ×§×™×™× ×‘-HTML
            // const next = document.getElementById('next'); // ×œ× ×§×™×™× ×‘-HTML
            let index = 0;
            const intervalMs = 3000;
            let timer = null;
            

            function update(){
                if (slidesEl) slidesEl.style.transform = `translateX(${-index*100}%)`;
            }

            function nextSlide(){ index = (index+1) % slides.length; update(); }
            function prevSlide(){ index = (index-1 + slides.length) % slides.length; update(); }
            function goTo(i){ index = ((i%slides.length)+slides.length)%slides.length; update(); resetTimer(); }

            function startTimer(){ if(timer) clearInterval(timer); timer = setInterval(nextSlide, intervalMs); }
            function resetTimer(){ startTimer(); }
            startTimer();

            const carouselWrap = document.querySelector('.carousel-wrap');
            carouselWrap.addEventListener('mouseenter', ()=>{ if(timer) clearInterval(timer); });
            carouselWrap.addEventListener('mouseleave', ()=>{ startTimer(); });

            update();
        })();


        // Handle 'Continue to Payment' button (Validation & Data Storage)
        continueToPaymentBtn.addEventListener('click', (e)=>{
            const name = document.getElementById('shippingName').value.trim();
            const phone = document.getElementById('shippingPhone').value.trim();
            const email = document.getElementById('shippingEmail').value.trim();
            const city = document.getElementById('shippingCity').value.trim();
            const address = document.getElementById('shippingAddress').value.trim();
            const copies = copiesInput.value;
            const totalPrice = paymentTotalAmount.textContent;
            
            if (!name || !phone || !email || !city || !address) {
                alert('×× × ××œ××• ××ª ×›×œ ×¤×¨×˜×™ ×”××©×œ×•×— ×”× ×“×¨×©×™×.');
                return;
            }
            
            currentOrderData = { name, phone, email, city, address, copies, totalPrice }; 

            closeModal(shippingModal);
            paymentModal.classList.add('show');
        });

        openBitApp.addEventListener('click', ()=>{
            sendOrderEmail(); 
            alert('×¤×¨×˜×™ ×”×”×–×× ×” × ×©×œ×—×• ×‘×”×¦×œ×—×”! ×›×¢×ª ×ª×•×¢×‘×¨×• ×œ××¢×¨×›×ª ×”×ª×©×œ×•× (×¡×™××•×œ×¦×™×”).');
            window.open('https://example.com/payment-link', '_blank');

            closeModal(paymentModal);
        });


        // Close Modals using the '×‘×™×˜×•×œ' buttons or outside click
        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', () => {
                const modalId = button.dataset.modal || (button.closest('.modal') ? button.closest('.modal').id : null);
                if (modalId === 'paymentModal') {
                    // Special case for Payment modal: close it and re-open shipping modal
                    closeModal(document.getElementById(modalId));
                    shippingModal.classList.add('show');
                } else if (modalId) {
                    closeModal(document.getElementById(modalId));
                }
            });
        });

        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => { 
                if(e.target === modal){ 
                    closeModal(modal);
                } 
            });
        });
    </script>
</body>

</html>
